<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>WebSocketSpike.WebServer</title>
    <script src="/Scripts/jquery-1.9.1.js"></script>
    <script src="/Scripts/jquery.signalR-2.1.2.js"></script>
    <script>
    $(function () {
        // Create connection and hub.
        var connection = $.hubConnection('http://localhost:8081');
        var messageHubProxy = connection.createHubProxy('MessageHub');

        // Create a function that the hub can call back to display messages.
        messageHubProxy.on('broadcastMessage', function (message) {
            $('#incoming').html(htmlEncode(message.Text));
        });

        // Set initial focus to message input box.
        $('#message').focus();

        connection.logging = true;

        // Start the connection. When done register a function on the button to send a message.
        connection.start().done(function () {
            $('#sendmessage').click(function () {
                messageHubProxy.invoke('Send', { Text: $('#message').val() });
                $('#message').val('').focus();
            });
            messageHubProxy.invoke('Send', { Text: 'Hello World.' });
            console.log('Hello World message sent.');
        }).fail(function () { $('#incoming').html('Connection failed.'); });
    });

    // This optional function HTML-encodes messages for display in the page.
    function htmlEncode(value) {
        var encodedValue = $('<div />').text(value).html();
        return encodedValue;
    }
    </script>
</head>
    <body>
        <h2>WebSocketSpike</h2>
        <div class="container">
            <div>
                <span>Message : </span>
                <input type="text" id="message" />
                <input type="button" id="sendmessage" value="Send" />
            </div>
            <div>
                <span>Received : </span>
                <span id="incoming"></span>
            </div>
        </div>
    </body>
</html>